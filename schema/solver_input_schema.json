{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Solver Input Schema",
  "type": "object",
  "required": [
    "domain",
    "fluid_properties",
    "initial_conditions",
    "simulation_parameters",
    "boundary_conditions",
    "mask",
    "external_forces"
  ],
  "properties": {
    "domain": {
      "type": "object",
      "required": [
        "x_min",
        "x_max",
        "y_min",
        "y_max",
        "z_min",
        "z_max",
        "nx",
        "ny",
        "nz"
      ],
      "properties": {
        "x_min": { "type": "number" },
        "x_max": { "type": "number" },
        "y_min": { "type": "number" },
        "y_max": { "type": "number" },
        "z_min": { "type": "number" },
        "z_max": { "type": "number" },
        "nx": { "type": "integer", "minimum": 1 },
        "ny": { "type": "integer", "minimum": 1 },
        "nz": { "type": "integer", "minimum": 1 }
      }
    },

    "fluid_properties": {
      "type": "object",
      "required": ["density", "viscosity"],
      "properties": {
        "density": { "type": "number", "exclusiveMinimum": 0 },
        "viscosity": { "type": "number", "minimum": 0 }
      }
    },

    "initial_conditions": {
      "type": "object",
      "required": ["velocity", "pressure"],
      "properties": {
        "velocity": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 3,
          "maxItems": 3
        },
        "pressure": { "type": "number" }
      }
    },

    "simulation_parameters": {
      "type": "object",
      "required": ["time_step", "total_time", "output_interval"],
      "properties": {
        "time_step": { "type": "number", "exclusiveMinimum": 0 },
        "total_time": { "type": "number", "exclusiveMinimum": 0 },
        "output_interval": { "type": "integer", "minimum": 1 }
      }
    },

    "boundary_conditions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["location", "type"],
        "properties": {
          "location": {
            "type": "string",
            "enum": ["x_min", "x_max", "y_min", "y_max", "z_min", "z_max"]
          },
          "type": {
            "type": "string",
            "enum": ["no-slip", "free-slip", "inflow", "outflow", "pressure"]
          },
          "values": {
            "type": "object",
            "properties": {
              "u": { "type": "number" },
              "v": { "type": "number" },
              "w": { "type": "number" },
              "p": { "type": "number" }
            }
          },
          "comment": { "type": "string" }
        }
      }
    },

    "mask": {
      "type": "array",
      "description": "Flat mask of length nx*ny*nz using canonical flattening: i + nx*(j + ny*k). Values: 1 = fluid, 0 = solid, -1 = boundary-fluid.",
      "items": {
        "type": "integer",
        "enum": [-1, 0, 1]
      }
    },

    "external_forces": {
      "type": "object",
      "required": ["force_vector"],
      "properties": {
        "force_vector": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 3,
          "maxItems": 3
        },
        "comment": { "type": "string" }
      }
    }
  }
}
