# .github/workflows/navier_stokes_dev_pipeline.yml

name: Navierâ€“Stokes Solver

on:
  push:
    branches:
      - "**"
  workflow_dispatch:

jobs:

  # code_quality_check:
  #   runs-on: ubuntu-latest

  #   steps:
  #     - name: ğŸ›ï¸ Checkout repository
  #       uses: actions/checkout@v3

  #     - name: ğŸ Set up Python
  #       uses: actions/setup-python@v4
  #       with:
  #         python-version: "3.11"

  #     - name: ğŸ Install Python dependencies
  #       run: |
  #         python -m pip install --upgrade pip
  #         pip install -r requirements.txt

  #     # ---------------------------------------------------------
  #     # OPTIONAL: jq installation (needed only for integration tests)
  #     # ---------------------------------------------------------
  #     # - name: ğŸ“¦ Install jq (if needed later)
  #     #   run: |
  #     #     sudo apt-get update
  #     #     sudo apt-get install -y jq
  #     # ---------------------------------------------------------

  #     - name: ğŸ§¹ Autoflake (remove unused imports)
  #       run: |
  #         pip install autoflake
  #         autoflake --in-place --recursive --remove-unused-variables --remove-all-unused-imports src

  #     - name: ğŸ’€ Vulture (dead code detection)
  #       run: |
  #         pip install vulture
  #         vulture src --min-confidence 70

  #     - name: ğŸ§¬ JSCPD (duplicate code detection)
  #       run: |
  #         npm install -g jscpd
  #         jscpd src --min-lines 5 --threshold 5 --reporters console

  #     - name: ğŸš€ Commit autoflake changes
  #       env:
  #         GIT_USER_NAME: ${{ secrets.GIT_USER_NAME }}
  #         GIT_USER_EMAIL: ${{ secrets.GIT_USER_EMAIL }}
  #       run: |
  #         git config --global user.name "${GIT_USER_NAME}"
  #         git config --global user.email "${GIT_USER_EMAIL}"
  #         git add .
  #         git diff --cached --quiet || (
  #           git commit -m "ğŸ§¹ Auto-clean: removed unused imports and variables"
  #           git push || echo "No changes to push"
  #         )

  unit_tests_only:
    # needs: code_quality_check
    runs-on: ubuntu-latest

    env:
      PYTHONPATH: ${{ github.workspace }}

    steps:
      - name: ğŸ—‚ï¸ Checkout Repository
        uses: actions/checkout@v3

      - name: ğŸ Setup Python & Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt pytest coverage numpy

      - name: ğŸ§ª Run Unit Tests Only (No Integration Tests)
        run: |
          echo "ğŸ” Running unit tests only..."
          pytest tests/ --verbose --cov=src --cov-report=term-missing
          echo "âœ… Unit tests completed."

      # ---------------------------------------------------------
      # âŒ REAL SOLVER EXECUTION DISABLED DURING DEVELOPMENT
      # ---------------------------------------------------------
      # - name: ğŸš€ Run Main Solver (DISABLED)
      #   run: |
      #     echo "âš ï¸ Solver execution disabled during development phase."
      #     # python core/master_solver.py input.json
      # ---------------------------------------------------------

      - name: ğŸ“¦ List repository structure
        run: |
          echo "ğŸ“ Repository structure:"
          ls -R
